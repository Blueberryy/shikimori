- if poster && poster.image_data['derivatives']
  - derivative = :main if derivative == :preview && !poster.cropped? && poster.image_data['derivatives'][derivative.to_s]['metadata']['height'] > poster.image_data['derivatives']['main']['metadata']['height'] * 1.2
  picture
    source[
      srcset='#{cdn_poster_url db_entry: db_entry, poster: poster, derivative: derivative}, #{cdn_poster_url db_entry: db_entry, poster: poster, derivative: :"#{derivative}_2x"} 2x'
      type='image/webp'
    ]
    img[
      alt=localized_name(db_entry)
      src=cdn_poster_url(db_entry: db_entry, poster: poster, derivative: :"#{derivative}_alt")
      srcset='#{cdn_poster_url db_entry: db_entry, poster: poster, derivative: :"#{derivative}_alt_2x"} 2x'
    ]
    / loading=(:lazy unless derivative == :main)
- else
  - derivative = :"preview_#{db_entry.anime? || db_entry.kinda_manga? ? :animanga : :charperson}" if derivative == :preview
  img[
    alt=localized_name(db_entry)
    src='/assets/globals/missing/#{derivative}.png'
    srcset='/assets/globals/missing/#{derivative}@2x.png 2x'
  ]
    / loading=(:lazy unless derivative == :main)
